<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		 
			
  
    <meta name="twitter:card" content="summary"/>
    
      <meta name="twitter:image" content="http://www.artacode.com/images/avatar.png" />
    
  
  
  <meta name="twitter:title" content="vscode 自定义代码片段"/>
  <meta name="twitter:description" content="实现效果 起因 最近在写一个全新的项目，在项目中频繁创建各种类，这就导致很多重复的东西需要频繁的写，例如类名，命名空间，继承关系&hellip;"/>
  
    <meta name="twitter:site" content="@your_twitter_id"/>
  
  
  
  
    <meta name="twitter:creator" content="@Argericy"/>
  



		
		<meta name="author" content="Argericy">
		<meta name="description" content="想成为一名艺术家的码农">
		<meta name="generator" content="Hugo 0.55.6" />
		<title>vscode 自定义代码片段 &middot; 一二三四吾</title>
		<link rel="shortcut icon" href="http://www.artacode.com/images/favicon.ico">
		<link rel="stylesheet" href="http://www.artacode.com/css/style.css">
		<link rel="stylesheet" href="http://www.artacode.com/css/highlight.css">

		
		<link rel="stylesheet" href="http://www.artacode.com/css/font-awesome.min.css">
		

		
		<link href="http://www.artacode.com/index.xml" rel="alternate" type="application/rss+xml" title="一二三四吾" />
		

		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='http://www.artacode.com/'> <span class="arrow">←</span>Home</a>
	
	<a href='http://www.artacode.com/posts'>Archive</a>
	<a href='http://www.artacode.com/tags'>Tags</a>
	<a href='http://www.artacode.com/about'>About</a>

	

	
	<a class="cta" href="http://www.artacode.com/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper" class="post">
            <article>
                <header>
                    <h1>
                        vscode 自定义代码片段
                    </h1>
                    <h2 class="headline">
                    Mar 9, 2019 17:54
                    · 2131 words
                    · 5 minute read· <span id="busuanzi_value_page_pv"></span>views
                    
                      <span class="tags">
                      
                      
                          
                              <a href="http://www.artacode.com/tags/ide">IDE</a>
                          
                              <a href="http://www.artacode.com/tags/%E5%B7%A5%E6%AC%B2%E5%96%84%E5%85%B6%E4%BA%8B%E5%BF%85%E5%85%88%E5%88%A9%E5%85%B6%E5%99%A8">工欲善其事，必先利其器</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                  
                    <div id="toc">
                      <nav id="TableOfContents">
<ul>
<li><a href="#实现效果">实现效果</a></li>
<li><a href="#起因">起因</a></li>
<li><a href="#提出设想">提出设想</a></li>
<li><a href="#资料查询">资料查询</a></li>
<li><a href="#snippet-示例">snippet 示例</a></li>
<li><a href="#snippet-语法">Snippet 语法</a>
<ul>
<li><a href="#制表位-tabstops">制表位(Tabstops)</a></li>
<li><a href="#占位符-placeholders">占位符(Placeholders)</a></li>
<li><a href="#选择项-choice">选择项(Choice)</a></li>
<li><a href="#变量-variables">变量(Variables)</a></li>
<li><a href="#变量转换-variable-transforms">变量转换(Variable transforms)</a></li>
</ul></li>
<li><a href="#需求实现">需求实现</a>
<ul>
<li><a href="#要解决的问题">要解决的问题</a></li>
<li><a href="#问题分析">问题分析</a></li>
<li><a href="#代码实现">代码实现</a></li>
</ul></li>
<li><a href="#一些思考">一些思考</a></li>
<li><a href="#参考链接">参考链接</a></li>
</ul>
</nav>
                    </div>
                  
                
                <section id="post-body">
                    

<h1 id="实现效果">实现效果</h1>

<p><img src="http://pic.artacode.com/1.gif" alt="" /></p>

<h1 id="起因">起因</h1>

<p>最近在写一个全新的项目，在项目中频繁创建各种类，这就导致很多重复的东西需要频繁的写，例如类名，命名空间，继承关系&hellip;那么有没有一种 办法能解决这个问题呢？</p>

<h1 id="提出设想">提出设想</h1>

<p>我想起了，最初用 <code>sublime text</code> 的时候，可以利用代码片段功能大段的生成html代码，当时就觉得十分的方便，那么 <code>vscode</code> 有没有这个功能呢?经过 <code>google</code> 之后我知道 <code>vscode</code> 是有代码片段功能的。既然有了想法，也具备了基础实施条件，那么接下来开始尝试实现之前的想法。</p>

<h1 id="资料查询">资料查询</h1>

<p>经过一番 <code>google</code> 后发现对于 <code>vscode snippet</code> 介绍都在相对基础的简单应用（只是一些插入固定代码和光标介绍），者显然无法实现我们生成类名和明明空间的想法，<code>google</code> 无果，那么只能看看 <code>vscode</code> 官方文档果然有意想不到的收获，看完官网介绍后，基本就确定此路是可行的。</p>

<h1 id="snippet-示例">snippet 示例</h1>

<p>在 <code>File &gt; Preferences (Code &gt; Preferences on macOS)</code> 中选择 <code>User Snippets</code> 在弹出框里选择对应的代码片段语言，我这里使用的是php</p>

<p><img src="http://pic.artacode.com/20190310095020.png" alt="" /></p>

<pre><code> &quot;Print to console&quot;: {
        &quot;prefix&quot;: &quot;log&quot;,
        &quot;body&quot;: [
            &quot;console.log('$1');&quot;,
            &quot;$2&quot;
        ],
        &quot;description&quot;: &quot;Log output to console&quot;
    }
</code></pre>

<p>在打开的 <code>php.json</code> 中有示例代码：</p>

<ul>
<li><code>Print to console</code> 代码片段名称</li>
<li><code>prefix</code> 插件前缀</li>
<li><code>body</code> 插件内容可以是字符串，也可以为数组，若为数组每个元素都做为单独的一行插入。</li>
<li><code>description</code> 插件描述<br /></li>

<li><h1 id="snippet-语法">Snippet 语法</h1>

<h2 id="制表位-tabstops">制表位(Tabstops)</h2>

<p>使用制表位(Tabstops)可是在代码片段中移动光标位置，使用<code>$1</code>,<code>$2</code>来指定光标的位置,数字代表光标的移动的顺序，值得注意的时<code>$0</code>代表光标的最后位置。如果有多个相同的制表位(Tabstops)会在编译器里同时出现多个光标（类似编译器的块编辑模式）。</p>

<h2 id="占位符-placeholders">占位符(Placeholders)</h2>

<p>占位符(Placeholders) 是带默认值的制表位(Tabstops),占位符(Placeholders)的文本会被插入到制表位(Tabstops)所在位置并且全选以方便修改,占位符(Placeholders)可以嵌套使用，比如<code>${1:another ${2:placeholder}}</code>。</p>

<h2 id="选择项-choice">选择项(Choice)</h2>

<p>占位符(Placeholders)可以有多选值，每个选项的值用 <code>,</code> 分隔，选项的开始和结束用管道符号(<code>|</code>)将选项包含，例如: <code>${1|one,two,three|}</code>，当插入代码片段，选择制制表位(Tabstops)的时候，会列出选项供用户选择。</p>

<h2 id="变量-variables">变量(Variables)</h2>

<p>使用 <code>$name</code> 或者 <code>${name|default}</code> 可以插入变量的值，如果变量未被赋值则插入 <code>default</code> 的值或者空值 。当变量未被定义，则将变量名插入，变量(Variables)将被转换为占位符(Placeholders)
系统变量如下</p></li>

<li><p><code>TM_SELECTED_TEXT</code> 当前选定的文本或空字符串</p></li>

<li><p><code>TM_CURRENT_LINE</code> 当前行的内容</p></li>

<li><p><code>TM_CURRENT_WORD</code> 光标下的单词的内容或空字符串</p></li>

<li><p><code>TM_LINE_INDEX</code> 基于零索引的行号</p></li>

<li><p><code>TM_LINE_NUMBER</code> 基于一索引的行号</p></li>

<li><p><code>TM_FILENAME</code> 当前文档的文件名</p></li>

<li><p><code>TM_FILENAME_BASE</code> 当前文档的文件名（不含后缀名)</p></li>

<li><p><code>TM_DIRECTORY</code> 当前文档的目录</p></li>

<li><p><code>TM_FILEPATH</code> 当前文档的完整文件路径</p></li>

<li><p><code>CLIPBOARD</code> 剪切板里的内容
插入当前日期或时间：</p></li>

<li><p><code>CURRENT_YEAR</code> 当前年(四位数)</p></li>

<li><p><code>CURRENT_YEAR_SHORT</code> 当前年(两位数)</p></li>

<li><p><code>CURRENT_MONTH</code> 当前月</p></li>

<li><p><code>CURRENT_MONTH_NAME</code> 本月的全名（’七月’）</p></li>

<li><p><code>CURRENT_MONTH_NAME_SHORT</code> 月份的简称（’Jul’）</p></li>

<li><p><code>CURRENT_DATE</code> 当前日</p></li>

<li><p><code>CURRENT_DAY_NAME</code> 当天的名称（’星期一’）</p></li>

<li><p><code>CURRENT_DAY_NAME_SHORT</code> 当天的短名称（’Mon’）</p></li>

<li><p><code>CURRENT_HOUR</code> 当前小时</p></li>

<li><p><code>CURRENT_MINUTE</code> 当前分钟</p></li>

<li><p><code>CURRENT_SECOND</code> 当前秒
当前语言的行注释或块注释:</p></li>

<li><p><code>BLOCK_COMMENT_START</code> 块注释开始标识,如 PHP <code>/*</code> 或 HTML <code>&lt;!--</code></p></li>

<li><p><code>BLOCK_COMMENT_END</code> 块注释结束标识,如 PHP <code>*/</code> 或 HTML <code>--&gt;</code></p></li>

<li><p><code>LINE_COMMENT</code> 行注释，如： PHP <code>//</code> 或 HTML <code>&lt;!-- --&gt;</code>
下面片则会生成 PHP /* Hello World */</p>

<pre><code>{
&quot;hello&quot;: {
    &quot;scope&quot;: &quot;php&quot;,
    &quot;prefix&quot;: &quot;hello&quot;,
    &quot;body&quot;: &quot;$BLOCK_COMMENT_START Hello World $BLOCK_COMMENT_END&quot;
}
}
</code></pre></li>
</ul>

<h2 id="变量转换-variable-transforms">变量转换(Variable transforms)</h2>

<p>变量转换(Variable transforms) 允许变量在插入前改变变量的值，变量转换(Variable transforms)由三部分组成
1. 正则匹配：使用正则表达式匹配变量值，若变量无法解析则值为空。
2. 格式串：允许引用正则表达式匹配组。格式串允许条件插入和做简单的修改。
3. 正则表达式匹配选项</p>

<p>下面例子是使用变量转换(Variable transforms)将带后缀的文件名转换为不带后缀的文件名</p>

<pre><code>${TM_FILENAME/(.*)\\..+$/$1/}
  |           |         |  |
  |           |         |  |-&gt; 无选项设置
  |           |         |
  |           |         |-&gt; 引用捕获组的第一个分组内容
  |           |             
  |           |
  |           |-&gt; 匹配后缀前的所有字符串
  |               
  |
  |-&gt; 文件名（带后缀）
</code></pre>

<h1 id="需求实现">需求实现</h1>

<h2 id="要解决的问题">要解决的问题</h2>

<p>生成Class 的命名空间、类名、选择继承关系</p>

<h2 id="问题分析">问题分析</h2>

<p>项目目录结构如下所示</p>

<pre><code>peoject
|
|----application
|--------admin
|------------services
|----------------TestServices.php
</code></pre>

<p>类名可以直接使用 <code>TM_FILENAME_BASE</code> 变量的值即可，命名空间则需要使用 <code>TM_DIRECTORY</code> 变量，以 <code>TestServices.php</code> 为例，<code>TM_DIRECTORY</code> 得到的目录为 <code>peoject\application\admin\services</code>我们只需要将<code>peoject\application\</code> 替换为 <code>app</code> 得到 <code>app\admin\services</code> 就是我们的明明空间了，至于继承就是一个选择项就可以了。既然已经全部知道该如何实现，接下来就是代码实现的过程了。</p>

<h2 id="代码实现">代码实现</h2>

<pre><code>&quot;service-construct&quot; :{
        &quot;prefix&quot;: &quot;gen&quot;,
        &quot;body&quot;: [
            &quot;namespace ${TM_DIRECTORY/.*application/app/};\n&quot;,
            &quot;class $TM_FILENAME_BASE extends ${1|BaseService,BaseController,BaseModel|}&quot;,
            &quot;{&quot;,
            &quot;\tpublic function __construct() \r\n    {\n\t\t\\$this-&gt;model = new \r\n\t}&quot;,
            &quot;}&quot;
        ],
        &quot;description&quot;: &quot;generate service class&quot;

    },
</code></pre>

<h1 id="一些思考">一些思考</h1>

<p>上述代码基本上完成了我要实现的功能，但是也存在了一些问题，例如：我现在是用 <code>windows</code> 操作系统，因而<code>TM_DIRECTORY</code> 得到的目录为 <code>peoject\application\admin\services</code> 若是 <code>linux</code> 系统，此代码片段是无法正常的生成命名空间的，我做了一些资料的搜索，代码片段并没有自定义变量的功能（也许可以，只是我么有找到方法，如果有知道的大牛，请留言赐教。<br />
随着对 <code>vscode snippet</code> 的深入了解，我之前所设想的方案要用代码片段的方式实现是有些困难的，<code>vscode</code> 将其作为一个快速生成代码的解决方案，我们所写的代码片段相当于一个带有填空模板，而对代码片段的应用就是生成带有制表符的代码模板，然后根据制表符顺序补全代码。<br />
至于这个不完美的方案，我打算再研究一下代码片段是否能完全实现，如果依旧解决不了，就选用其它方案进行尝试。</p>

<h1 id="参考链接">参考链接</h1>

<p><a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets">Creating your own snippets</a></p>

                </section>
            </article>

            
                <a class="twitter" href="https://twitter.com/intent/tweet?text=http%3a%2f%2fwww.artacode.com%2fposts%2fide%2fvs-code%2fsnippet%2f - vscode%20%e8%87%aa%e5%ae%9a%e4%b9%89%e4%bb%a3%e7%a0%81%e7%89%87%e6%ae%b5 by @your_twitter_id"><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

            

            

	        
                <div id="gitalk-container"></div>
   <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
  clientID: '7df62c8e117826bf4f9b',
  clientSecret: 'd4de6ff8c99044fae0ef8466c107f48e754780fa',
  repo: 'hugo',
  owner: 'yunxi177',
  admin: ['yunxi177'],
  id: 'ide-vs-code-snippet',      
  distractionFreeMode: false  
})

gitalk.render('gitalk-container')
</script>



            

            

            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://github.com/yunxi177">
        <i class="fa fa-github-square"></i>
    </a>
    


</div>

    
    <p class="small">
    
       © Copyright 2019 <i class="fa fa-heart" aria-hidden="true"></i> Argericy
    
    </p>
    <p class="small">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">本站总访问量 <a id="busuanzi_value_site_pv"></a> 次</span>
        <span>您是本站的第 <a id="busuanzi_value_site_uv"></a> 位访客</span>
    </p>
    <p class="small">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/nodejh/hugo-theme-cactus-plus">nodejh</a>
    </p>
</footer>
        </section>

        <script src="http://www.artacode.com/js/jquery-3.3.1.min.js"></script>
<script src="http://www.artacode.com/js/main.js"></script>
<script src="http://www.artacode.com/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123407925-1', 'auto');
	
	ga('send', 'pageview');
}
</script>




<script>
var baiduAnalytics = '118e166eca53816aaead0948042f2989';
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?" + baiduAnalytics;
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


    </body>
</html>
